---
layout: default
---
<div class="transcript-archive">
  <header class="archive-header">
    <h1>{{ page.title }}</h1>
    <p class="archive-description">{{ content }}</p>
  </header>

  <div class="archive-controls" id="archive-controls">
    <div class="search-box">
      <input type="text" id="search-input" placeholder="Search guests, topics, or titles..." autocomplete="off">
    </div>

    <div class="filter-controls">
      <select id="topic-filter">
        <option value="">All Topics</option>
        {% assign all_topics = "" | split: "" %}
        {% for transcript in site.transcripts %}
          {% for topic in transcript.topics %}
            {% assign all_topics = all_topics | push: topic %}
          {% endfor %}
        {% endfor %}
        {% assign unique_topics = all_topics | uniq | sort %}
        {% for topic in unique_topics %}
        <option value="{{ topic }}">{{ topic }}</option>
        {% endfor %}
      </select>

      <select id="sort-select">
        <option value="date-desc">Newest First</option>
        <option value="date-asc">Oldest First</option>
        <option value="views">Most Viewed</option>
        <option value="guest">A-Z by Guest</option>
      </select>

      <button class="reset-btn" id="reset-btn" style="display: none;">Reset</button>
    </div>
  </div>

  <div class="archive-stats">
    <span id="showing-count">{{ site.transcripts.size }}</span> of {{ site.transcripts.size }} episodes
  </div>

  <div class="transcript-grid" id="transcript-grid">
    {% assign sorted_transcripts = site.transcripts | sort: "publish_date" | reverse %}
    {% for transcript in sorted_transcripts %}
    <article class="transcript-card"
             data-guest="{{ transcript.guest | downcase }}"
             data-title="{{ transcript.title | downcase }}"
             data-topics="{{ transcript.topics | join: ',' }}"
             data-date="{{ transcript.publish_date | date: '%Y-%m-%d' }}"
             data-views="{{ transcript.view_count | default: 0 }}">
      <a href="{{ transcript.url | relative_url }}" class="card-link">
        <div class="card-thumb">
          <div class="skeleton-loader"></div>
          <img src="https://img.youtube.com/vi/{{ transcript.video_id }}/mqdefault.jpg"
               alt="{{ transcript.guest }}"
               loading="lazy"
               onload="this.parentElement.classList.add('loaded')">
          <span class="duration">{{ transcript.duration }}</span>
        </div>
        <div class="card-content">
          <h3 class="card-guest">{{ transcript.guest }}</h3>
          <p class="card-title">{{ transcript.title | truncate: 80 }}</p>
          <div class="card-meta">
            <span class="meta-date">{{ transcript.publish_date | date: "%b %-d, %Y" }}</span>
            {% if transcript.view_count and transcript.view_count > 0 %}
              {% if transcript.view_count >= 1000000 %}
            <span class="meta-views">{{ transcript.view_count | divided_by: 1000000.0 | round: 1 }}M views</span>
              {% elsif transcript.view_count >= 1000 %}
            <span class="meta-views">{{ transcript.view_count | divided_by: 1000.0 | round: 1 }}K views</span>
              {% else %}
            <span class="meta-views">{{ transcript.view_count }} views</span>
              {% endif %}
            {% endif %}
          </div>
          {% if transcript.topics %}
          <div class="card-topics">
            {% for topic in transcript.topics limit: 3 %}
            <span class="topic-tag-small">{{ topic }}</span>
            {% endfor %}
          </div>
          {% endif %}
        </div>
      </a>
    </article>
    {% endfor %}
  </div>

  <div class="no-results" id="no-results" style="display: none;">
    <p>No episodes found matching your criteria.</p>
    <button onclick="resetFilters()">Reset Filters</button>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const searchInput = document.getElementById('search-input');
  const topicFilter = document.getElementById('topic-filter');
  const sortSelect = document.getElementById('sort-select');
  const resetBtn = document.getElementById('reset-btn');
  const grid = document.getElementById('transcript-grid');
  const cards = Array.from(document.querySelectorAll('.transcript-card'));
  const showingCount = document.getElementById('showing-count');
  const noResults = document.getElementById('no-results');
  const controls = document.getElementById('archive-controls');

  // Sticky filter bar on scroll
  let lastScroll = 0;
  window.addEventListener('scroll', function() {
    const currentScroll = window.pageYOffset;
    if (currentScroll > 200) {
      controls.classList.add('sticky');
    } else {
      controls.classList.remove('sticky');
    }
    lastScroll = currentScroll;
  });

  // Check URL params for initial filter
  const urlParams = new URLSearchParams(window.location.search);
  const topicParam = urlParams.get('topic');
  if (topicParam) {
    topicFilter.value = topicParam;
  }

  function updateResetButton() {
    const hasFilters = searchInput.value || topicFilter.value || sortSelect.value !== 'date-desc';
    resetBtn.style.display = hasFilters ? 'inline-block' : 'none';
  }

  function filterAndSort() {
    const searchTerm = searchInput.value.toLowerCase().trim();
    const selectedTopic = topicFilter.value;
    const sortBy = sortSelect.value;

    let visibleCards = cards.filter(card => {
      const guest = card.dataset.guest;
      const title = card.dataset.title;
      const topics = card.dataset.topics.split(',');

      const matchesSearch = !searchTerm ||
        guest.includes(searchTerm) ||
        title.includes(searchTerm) ||
        topics.some(t => t.toLowerCase().includes(searchTerm));

      const matchesTopic = !selectedTopic ||
        topics.includes(selectedTopic);

      return matchesSearch && matchesTopic;
    });

    // Sort
    visibleCards.sort((a, b) => {
      switch(sortBy) {
        case 'date-desc':
          return new Date(b.dataset.date) - new Date(a.dataset.date);
        case 'date-asc':
          return new Date(a.dataset.date) - new Date(b.dataset.date);
        case 'views':
          return parseInt(b.dataset.views) - parseInt(a.dataset.views);
        case 'guest':
          return a.dataset.guest.localeCompare(b.dataset.guest);
        default:
          return 0;
      }
    });

    // Update DOM
    grid.innerHTML = '';
    visibleCards.forEach(card => grid.appendChild(card));

    // Hide cards not in filtered list
    cards.forEach(card => {
      card.style.display = visibleCards.includes(card) ? 'block' : 'none';
    });

    // Update count and reset button
    showingCount.textContent = visibleCards.length;
    noResults.style.display = visibleCards.length === 0 ? 'block' : 'none';
    updateResetButton();
  }

  searchInput.addEventListener('input', filterAndSort);
  topicFilter.addEventListener('change', filterAndSort);
  sortSelect.addEventListener('change', filterAndSort);

  // Initial filter if URL param present
  if (topicParam) {
    filterAndSort();
  }

  // Reset function
  window.resetFilters = function() {
    searchInput.value = '';
    topicFilter.value = '';
    sortSelect.value = 'date-desc';
    filterAndSort();
    // Update URL
    window.history.replaceState({}, '', window.location.pathname);
  };

  resetBtn.addEventListener('click', resetFilters);
});
</script>
